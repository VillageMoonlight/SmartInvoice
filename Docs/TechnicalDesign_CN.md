
# 技术设计文档 (Technical Design Document)

## 1. 架构概述
本项目由原本的纯前端架构演进为 **Client-Server** 架构，以支持多客户端数据同步。

- **前端层 (UI)**: 基于 React 19 和 Tailwind CSS。
- **通信层 (API)**: 使用标准 RESTful API 进行数据交换。
- **后端层 (Server)**: 基于 Node.js + Express，负责业务逻辑处理。
- **持久化层 (DB)**: 使用 **SQLite** 数据库，通过磁盘文件持久化所有台账和配置数据。

## 2. 核心模块设计

### 2.1 数据持久化逻辑 (Persistence)
- 数据库文件默认存储在 `/app/data/database.sqlite`（Docker 模式）或项目根目录。
- 采用 `sqlite3` 驱动，通过序列化执行确保初始化表结构。
- 发票明细与主表关系：为了方便财务导出，每一行明细作为一条独立记录，关联相同的发票号码。

### 2.2 多用户与同步
- 状态管理：用户登录状态通过 `localStorage` 维护，但权限校验由后端接口返回的 `status` 字段决定。
- 并发处理：SQLite 处理小型财务台账的并发读写具有极高效率，足以支撑中小型团队使用。

### 2.3 发票识别流 (OCR Pipeline)
- 识别依然在前端调用 AI 服务，然后将提取的结构化数据与 Base64 文件 URL 一并提交给后端存储。

## 3. 安全与扩展性
- **容器化**: 使用 Docker 卷挂载（Volume）确保容器重启后数据不丢失。
- **数据隐私**: 数据存储在您自己的服务器或私有云中，不再局限于单一浏览器的缓存，提高了数据的可迁移性。
